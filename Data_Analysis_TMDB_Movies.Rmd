---
title: "Data_Cleaning_TMDB_Movies"
output:
  html_document:
    toc: true
    toc_depth: 3
    df_print: paged
---

![image from Unsplash](images/krists-luhaers-AtPWnYNDJnM-unsplash.jpg)

# Problem Identification and Research Question :

In the current landscape of the film industry, data analysis has become an essential tool for grasping market trends and predicting the success of movies. In this data analysis endeavor, our aim is to delve into an extensive film database sourced from [The Movie Database (TMDB)](https://www.themoviedb.org/){style="color: #4e7fb0;"}  to pinpoint and categorize the standout films of the past five years.

This data analysis project is geared towards offering a comprehensive and updated perspective on the cinematic scene. Leveraging data analysis techniques in R, our objective is to identify the top-performing movies from the last five years and gain insights into the factors underpinning their success.

# The Data :

In this data analysis project, we will utilize a comprehensive database containing over 1 million movies (1008166), sourced from [Full Movies TMDB 2024](https://www.kaggle.com/datasets/asaniczka/tmdb-movies-dataset-2023-930k-movies/data){style="color: #4e7fb0;"}. The dataset comprises the following variables:

-   `TMDB_movie_dataset_v11.csv`

| Variable               | Description                                  |
|------------------------|----------------------------------------------|
| `id`                   | Unique identifier for each movie             |
| `vote_count`           | Number of votes received by the movie        |
| `revenue`              | Revenue generated by the movie               |
| `backdrop_path`        | Path to the backdrop image of the movie      |
| `imdb_id`              | IMDb identifier of the movie                 |
| `overview`             | Summary or plot synopsis of the movie        |
| `tagline`              | Promotional tagline of the movie             |
| `production_countries` | Countries where the movie was produced       |
| `title`                | Title of the movie                           |
| `status`               | Production status of the movie               |
| `runtime`              | Duration in minutes of the movie             |
| `budget`               | Production budget of the movie               |
| `original_language`    | Original language of the movie               |
| `popularity`           | Popularity index of the movie                |
| `genres`               | Genres of the movie                          |
| `spoken_languages`     | Spoken languages in the movie                |
| `vote_average`         | Average rating of the movie by users         |
| `release_date`         | Release date of the movie                    |
| `adult`                | Indicator of whether the movie is for adults |
| `homepage`             | Official homepage of the movie               |
| `original_title`       | Original title of the movie                  |
| `poster_path`          | Path to the poster image of the movie        |
| `production_companies` | Production companies involved in the movie   |

```{r}
library(tidyverse)
library(psych)

setwd("~/Proyectos R/archive (5)")


TMDB_data <- read.csv("TMDB_movie_dataset_v11.csv")
```

# Data Cleaning and Preprocessing :

## View Data

```{r}
head(TMDB_data, 10)
```

## View Structure

```{r}
glimpse(TMDB_data)

```

Upon examination, our database boasts an impressive count of precisely 1,008,166 movies. Furthermore, we're equipped with a rich array of over 20 variables for comprehensive analysis.

Variable Types Breakdown:

-   `chr` (Character): Comprising 16 variables

-   `int` (Integer): Encompassing 4 variables

-   `dbl` (Double): Incorporating 3 variables

## Handling Missing Values :

```{r}
missing_values <- colSums(is.na(TMDB_data))

tibble(Variables = names(missing_values), missing_values = missing_values)

```

Great news! Our dataset is clean and free of any missing values. We're all set to dive into our analysis with confidence!

## Handling Outliers

```{r}
numeric_variable <- TMDB_data %>%
  select_if(is.numeric)

describe(numeric_variable)
```

Interesting, firstly, we notice that both `revenue` and `runtime` have negative values, which is entirely impossible in movies. `revenue` also has many values equal to 0, which is logical because nowadays a large portion of movies released do not exclusively premiere in big cinemas but also on platforms like Netflix, HBO MAX, Disney+, etc. This makes it very complicated to calculate movie revenues. Additionally, the maximum value of `runtime` is an enormous number, which also lacks logic.

We also observe:

Let's attempt to correct these outliers:

```{r}
Outliers_values <- TMDB_data %>%
  filter( title %in% c("Adventures in Bora Bora", "The Bear") | title == "Untitled" | original_title == "Untitled" | status == "Canceled" | status == "Rumored" | status == "Planned" | revenue < 0 | runtime < 0 )

#checking revenue 
TMDB_data <- TMDB_data %>%
  filter(!revenue < 0, !title %in%  c("Adventures in Bora Bora", "The Bear"))


#checking runtime
TMDB_data <- TMDB_data %>%
  filter(!runtime < 0)

#checking title without names
TMDB_data <- TMDB_data %>%
  filter(!title == "Untitled")

#checking Films canceled, Rumored and Planned
TMDB_data <- TMDB_data %>%
  filter(!status %in% c("Canceled", "Rumored", "Planned"))



Outliers_values
  
```

## Data Transformation

Previously, we observed a significant number of character-type variables. Let's proceed by transforming these variables into categorical variables to facilitate subsequent movie analysis.

```{r}
TMDB_data_pre <- TMDB_data %>%
  select(-release_date) %>%
  mutate_if(is.character, as.factor)

summary(TMDB_data_pre)
```

Excellent, we now have a somewhat clearer overview of the database for our subsequent analysis.

Nevertheless, we don't require as many variables for our primary goal; let's choose only the most pertinent variables and data from 2018 onwards.

```{r}
TMDB_data_pre$release_date <- TMDB_data$release_date

TMDB_data <- TMDB_data_pre

TMDB_data <- TMDB_data %>%
  select(id, title, release_date, status, runtime,popularity, vote_average, vote_count, revenue, budget, production_companies, genres, original_language, adult) %>%
  filter(release_date > 2018)



TMDB_data$release_date <- as.Date(TMDB_data$release_date, format =  "%Y-%m-%d")

TMDB_data$year <- year(TMDB_data$release_date)
TMDB_data$month <- month(TMDB_data$release_date, label = TRUE)


TMDB_data %>%
  filter(vote_average > 7) %>%
  arrange(desc(popularity)) %>%
  head()

```

We've pruned unnecessary variables and filtered our updated database to include only films released after 2018, focusing on the past 5 years.

Let's keep in mind our goal: to identify the cream of the crop! To do so, we'll narrow our focus to feature-length films with substantial budgets, relying on popularity and average ratings to pinpoint the top contenders.

```{r}
TMDB_data <- TMDB_data %>%
  filter(runtime > 60) # para excluir cortometrajes

TMDB_data <- TMDB_data %>% # para excluir la gran mayoria de peliculas con bajo presupesto
  filter(budget > 100000) %>%
  mutate(revenue_in_million = round(revenue/1000000, 3), budget_in_million = round(budget/1000000,3)) 


TMDB_data %>%
  select(-c("revenue", "budget"))
TMDB_data %>%
  arrange(budget_in_million)
  

TMDB_data <- TMDB_data %>%
  filter(vote_average > 7) %>%
  arrange(desc(popularity))

```

```{r}
glimpse(TMDB_data)

```

Amazingly, after completing all the data cleaning and transformation, we're left with just `739 movies` out of over `1 million movies`. 



# Data Analysis

With the necessary data at hand, we delve into an in-depth analysis of top movies, examining each variable meticulously.

## Analysis


````{r}



ggplot(TMDB_data, aes(year))+
  geom_histogram(binwidth = 1, fill = "#67C6E3", color = "black") +
  labs(title = "Total Number of Top Movies Released from 2018 to 2024", x = "year", y = "Number of Movies")

ggplot(TMDB_data, aes(x = month)) +
  geom_bar(fill = "#67C6E3") +
  theme(axis.text.x = element_text(angle = 90, vjust = -0.01)) +
  facet_wrap(~year) +
  labs(title = "Total Number of Top Movies Released by Year and Month (2018-2024)", x = "Month", y = "Number of Movies")


````


````{r}

ggplot(TMDB_data, aes(runtime)) +
         geom_histogram(fill = "#67C6E3") + 
  labs(title = "Movie Runtime Distribution", x = "Runtime (in minutes)", y = "Count")


TMDB_data %>%
  filter(runtime > 400)
````

We observe a predominant trend towards movies with a duration of approximately 100 minutes, translating to around 1 hour and 40 minutes. This duration seems to be the favored choice among filmmakers for captivating storytelling.


````{r}

ggplot(TMDB_data, aes(popularity)) +
         geom_histogram(fill = "#67C6E3") +
  labs(title = "Movie Popularity Distribution", x = "Popularity", y = "Count")

TMDB_data %>%
  filter(popularity > 2000)

````

Upon closer examination of the dataset, it becomes evident that the majority of movies fall into the realm of relative obscurity, marked by a left-skewed distribution in popularity scores. However, two outliers, "Gran Turismo" and "Blue Beetle," stand out as exceptionally popular among audiences, defying the norm.


````{r}

ggplot(TMDB_data, aes(vote_average)) +
         geom_histogram(fill = "#67C6E3")+
  labs(title = "Movie Vote Average Distribution", x = "Vote Average", y = "Count")

````


This histogram exhibits a slight left-skew, with scores predominantly clustered in the lower range, typically between 7 and 8 out of 10.


````{r}

ggplot(TMDB_data, aes(vote_count)) +
         geom_histogram(fill = "#67C6E3")+
  xlim(0,27714)+
  ylim(0,100) +
  labs(title = "Movie Vote Distribution", x = "Vote", y = "Count")

TMDB_data %>%
  filter(vote_count > 20000)
````

We observe a left-skewed distribution, similar to that of popularity, indicating that the majority of movies in our dataset receive relatively few votes. This trend suggests that these films may struggle to gain traction due to their limited visibility, making it difficult for TMDB users to discover these lesser-known gems. However, it's noteworthy to mention the top four highest-rated movies, two of which hail from the Marvel universe:

- `Avengers: Infinity War`: Garnering 27,713 votes with an impressive average rating of 8.25

- `Avengers: Endgame`: Accumulating 23,857 votes with a closely comparable average rating of 8.26

- `Joker`: Amassing 23,425 votes with a commendable average rating of 8.16

- `Black Panther`: Securing 21,053 votes with a respectable average rating of 7.39



````{r}


ggplot(TMDB_data, aes(revenue_in_million)) +
         geom_histogram(fill = "#67C6E3")+
  labs(title = "Movie Revenue Distribution in million", x = "Revenue (in million)", y = "Count")


````

Similarly, we witness a left-skewed distribution in this histogram, indicative of the complexities associated with precisely measuring the true earnings of films released via online platforms. The prevalence of zero scores within our dataset underscores the inherent difficulty in assessing their financial performance accurately. Additionally, it's noteworthy that the majority...

````{r}


ggplot(TMDB_data, aes(budget_in_million)) +
         geom_histogram(fill = "#67C6E3")+
  labs(title = "Movie Budget Distribution in million", x = "Budget (in million)", y = "Count")

TMDB_data %>%
  filter(budget_in_million > 300)

````

We continue to notice a left-skewed pattern in the histogram, suggesting that most films have budgets below the one-million-dollar threshold, typically falling within the range of `$100,000` to `$1,000,000`. Notably, the three films commanding the highest budgets are:

- `Avatar: The Way of Water`: $460 million

- `Avengers: Endgame`: $356 million
- `Fast & Furious X`: $340 million

````{r}

TMDB_data_earnings_losses <- TMDB_data %>%
  filter(revenue_in_million > 0) %>%
  mutate(earnings_and_losses = revenue_in_million-budget_in_million)

TMDB_data_earnings_losses <- TMDB_data_earnings_losses %>%
  mutate(earn_of_lose = ifelse(earnings_and_losses >= 0, "Earnings", "Losses"), year = year(release_date))

TMDB_data_average_gains_and_losses <- TMDB_data_earnings_losses %>%
  group_by(year, earn_of_lose) %>%
  summarize(mean_earn_lose = round(mean(earnings_and_losses), 3))


ggplot(TMDB_data_average_gains_and_losses, aes(year, mean_earn_lose, fill = earn_of_lose))+
  geom_bar(stat = "identity")+
  scale_fill_manual(values = c("Earnings" = "#67C6E3", "Losses" = "#FF6969")) +
  geom_text(aes(label = mean_earn_lose, y = ifelse(earn_of_lose == "Earnings", mean_earn_lose * 1.05, mean_earn_lose * 1.4)), color = "black") +
  labs(title = "Stacked Bar Chart of Average Gains and Losses by Year (2018-2024)", x = "", y = "mean_(in million)", fill = "earn/lose")

````

We can discern that 2019 emerged as a standout year, boasting the highest average profits per film, exceeding `$232 million`. However, it also faced losses averaging around `$11 million per film`. Undoubtedly, it marked a significant milestone for the cinema industry. Conversely, the subsequent year witnessed a substantial downturn in profits among top-performing movies, with earnings hovering around `$77 million` and losses escalating to `$23 million` per film. While this figure may appear substantial to the average viewer, within the cinematic realm, it signifies a considerable setback, particularly considering these films' high ratings and widespread popularity aimed at societal impact. It's crucial to acknowledge that 2020 bore the brunt of the COVID-19 pandemic, with global lockdowns likely contributing to the decline in profits for most films.

Following that challenging period, subsequent years showed promise, with profits more than doubling in 2021 compared to 2020, reaching approximately `$170` to `$210 million`.


````{r}

TOP3_language <- TMDB_data_earnings_losses %>%
  filter(!original_language == "cn") %>%
  group_by(original_language) %>%
  summarize(mean_earnings = mean(earnings_and_losses)) %>%
  arrange(desc(mean_earnings)) %>%
  head(3)


ggplot(TOP3_language, aes(reorder(original_language, mean_earnings), mean_earnings))+
  geom_bar(stat = "identity", fill = "#67C6E3")+
  coord_flip()+
  labs(title = "Top 3 Languages by Average Revenue", x = "", y = "Mean revenue (in million)")




````

Impressively, Asian films command a substantial presence in the film industry. Specifically, a standout Chinese (zh) production released between 2018 and 2024 boasts an average profit nearing $300 million. This highlights the growing influence and lucrative nature of Asian cinema on a worldwide scale.

